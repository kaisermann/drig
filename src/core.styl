_rfDiv = unquote(rolleiflex.classScaleDivisor)
_rfPref = unquote(rolleiflex.classPrefix)
_rfColGutter = r-unit(rolleiflex.spaces.gutter / 2);

r-unit(p)
	if(rolleiflex.use.em)
		return unit(p / rolleiflex.baseFontSize, "em")
	return unit(p,"px")

r-makeBreakpointGrid(scaleName)
	scaleName = unquote(scaleName)
	isFirstBP = rolleiflex.breakpoints[scaleName].breakpoint == 0

	// For rows
	.{_rfPref}row
		&.-{_rfPref}no-gutter{_rfDiv}{scaleName}
			margin-left: 0;
			margin-right: 0;

			> .{_rfPref}col
				padding-left: 0;
				padding-right: 0;
				
		&.-{_rfPref}with-gutter{_rfDiv}{scaleName}
			margin-left: -(_rfColGutter);
			margin-right: -(_rfColGutter);

			> .{_rfPref}col
				padding-left: _rfColGutter;
				padding-right: _rfColGutter;

	// For columns
	.-{_rfPref}size{_rfDiv}{scaleName}
		flex: 1 1 auto;
		
	for col in (1..rolleiflex.columns)
		percentageWidth = round(percentage(col/rolleiflex.columns),6)
		offsetWidth = round(percentage((col - 1)/rolleiflex.columns),6)

		&.-{_rfPref}size-{col}{_rfDiv}{scaleName}
			flex-basis: percentageWidth;
			max-width: percentageWidth;

		&.-{_rfPref}offset-{col - 1}{_rfDiv}{scaleName}
			margin-left: offsetWidth;

		if(rolleiflex.build.verticalGrid)
			.{_rfPref}row.-{_rfPref}vertical &
				.-{_rfPref}size-{col}{_rfDiv}{scaleName}
					max-height: percentageWidth;
					max-width: initial;

				.-{_rfPref}offset-{col - 1}{_rfDiv}{scaleName}
					margin-left: initial;
					margin-top: offsetWidth;

	// Generic
		
	.-{_rfPref}justify-start{_rfDiv}{scaleName}
		justify-content: flex-start;

	.-{_rfPref}justify-center{_rfDiv}{scaleName}
		justify-content: center;

	.-{_rfPref}justify-end{_rfDiv}{scaleName}
		justify-content: flex-end;

	.-{_rfPref}justify-around{_rfDiv}{scaleName}
		justify-content: space-around;

	.-{_rfPref}justify-between{_rfDiv}{scaleName}
		justify-content: space-between;

	.-{_rfPref}align-start{_rfDiv}{scaleName}
		align-items: flex-start;

	.-{_rfPref}align-center{_rfDiv}{scaleName}
		align-items: center;
	
	.-{_rfPref}wrapped-stretch{_rfDiv}{scaleName}
		align-content: stretch;

	.-{_rfPref}wrapped-start{_rfDiv}{scaleName}
		align-content: flex-start;

	.-{_rfPref}wrapped-end{_rfDiv}{scaleName}
		align-content: flex-end;

	.-{_rfPref}wrapped-center{_rfDiv}{scaleName}
		align-content: center;

	.-{_rfPref}wrapped-between{_rfDiv}{scaleName}
		align-content: space-between;

	.-{_rfPref}wrapped-around{_rfDiv}{scaleName}
		align-content: space-around;

	.-{_rfPref}align-end{_rfDiv}{scaleName}
		align-items: flex-end;

	.-{_rfPref}self-start{_rfDiv}{scaleName}
		align-self: flex-start;

	.-{_rfPref}self-center{_rfDiv}{scaleName}
		align-self: center;

	.-{_rfPref}self-end{_rfDiv}{scaleName}
		align-self: flex-end;
		
	.-{_rfPref}no-wrap{_rfDiv}{scaleName}
		flex-wrap: nowrap;
		
	.-{_rfPref}with-wrap{_rfDiv}{scaleName}
		flex-wrap: wrap;
		
	.-{_rfPref}at-first{_rfDiv}{scaleName}
		order: -1;

	.-{_rfPref}at-last{_rfDiv}{scaleName}
		order: 1;
			
	.-{_rfPref}grow-none{_rfDiv}{scaleName}
		flex-grow: 0;
			
	.-{_rfPref}shrink-none{_rfDiv}{scaleName}
		flex-shrink: 0;
			
	.-{_rfPref}grow-single{_rfDiv}{scaleName}
		flex-grow: 1;
			
	.-{_rfPref}shrink-single{_rfDiv}{scaleName}
		flex-shrink: 1;
			
	.-{_rfPref}grow-double{_rfDiv}{scaleName}
		flex-grow: 2;
			
	.-{_rfPref}shrink-double{_rfDiv}{scaleName}
		flex-shrink: 2;

	// Text alignment helpers
	if(rolleiflex.build.responsiveText)
		for alignment in (left center right justify)
			.h-text-{alignment}{_rfDiv}{scaleName}
				text-align: alignment;
				
buildRolleiflexGrid()
	if(rolleiflex.build.container)
		.{_rfPref}container
		.{_rfPref}container-fluid
			max-width: 100%;
			margin-right: auto;
			margin-left: auto;
			padding-right: r-unit(rolleiflex.spaces.containerPadding);
			padding-left: r-unit(rolleiflex.spaces.containerPadding);
			if(rolleiflex.autoBorderBox)
				box-sizing: border-box;
				
	.h-display-flex
		display: flex;

	.{_rfPref}row
	.{_rfPref}col
		@extend .h-display-flex
		if(rolleiflex.autoBorderBox)
			box-sizing: border-box;
			
	.{_rfPref}col
		flex-flow: column nowrap;
		padding-right: _rfColGutter;
		padding-left: _rfColGutter;
		flex: 1 1 100%;
		max-width: 100%;

	.{_rfPref}row
		flex: 1 1;
		flex-flow: row wrap;
		margin-right: -(_rfColGutter);
		margin-left: -(_rfColGutter);

		&.-{_rfPref}reverse
			flex-direction: row-reverse;

		if(rolleiflex.build.verticalGrid)
			&.-{_rfPref}vertical
				margin-left: initial
				margin-right: initial;
				margin-top: -(_rfColGutter);
				margin-bottom: -(_rfColGutter);
				flex-direction: column;

				> .{_rfPref}col
						padding-left: initial;
						padding-right: initial;
						padding-top: _rfColGutter;
						padding-bottom: _rfColGutter;

				&.-{_rfPref}reverse
					flex-direction: column-reverse;

	for scaleName, scaleOptions in rolleiflex.breakpoints
		if(scaleOptions.breakpoint == 0)
			r-makeBreakpointGrid(scaleName);
		else
			@media (min-width: r-unit(scaleOptions.breakpoint))
				if(rolleiflex.build.container)
					.{_rfPref}container
						width: r-unit(scaleOptions.container);
				r-makeBreakpointGrid(scaleName);
				
	// Generic as f*ck
	.{_rfPref}row.-{_rfPref}fill > .{_rfPref}col > *
	.{_rfPref}col.-{_rfPref}fill > *
		flex-grow: 1;
